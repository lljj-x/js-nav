/** @license @lljj/nav (c) 2020-2021 Liu.Jun License: MIT */
function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function i(t){return String(t)===t}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;if(t instanceof NodeList)return Array.from(t);if(t instanceof HTMLElement)return[t];if(i(t))return Array.from(e.querySelectorAll(t));throw new Error("请传入一个正确的选择器")}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"addEventListener";t.forEach((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.target,o=t.eventName,r=t.handler,i=t.useCapture,a=void 0!==i&&i;Array.isArray(o)?o.forEach((function(t){n[e](t,r,a)})):n[e](o,r,a)}))}var s=function(t,e){try{var n=document.defaultView.getComputedStyle(t,"");return t.style[e]||n?n[e]:null}catch(n){return t.style[e]}},c=function(t,e){return s(t,null!==e||void 0!==e?e?"overflow-y":"overflow-x":"overflow").match(/(scroll|auto)/)},u=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.html,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"offsetTop",o=0;null!==t&&t!==e;)o+=t[n],t=t.offsetParent;return o},h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.html;return u(t,e,"offsetLeft")},v=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.html;return u(t,e)};var m=function(t){return t.scrollTop||window.pageYOffset||document.documentElement.scrollTop},f=function(t,e){var n=e>0?e:0;t===window?(document.documentElement.scrollTop=n,document.body.scrollTop=n):t.scrollTop=n},d=function(t){return Math.pow(t,3)},p=function(t){return t<.5?d(2*t)/2:1-d(2*(1-t))/2};!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}(".lj-horizontal-nav {\n    text-align: center;\n    overflow: auto;\n}\n    .lj-horizontal-nav::-webkit-scrollbar {\n        width: 0;\n        height: 0;\n    }\n    .lj-horizontal-nav .lj-nav-wrapper {\n        display: inline-block;\n        vertical-align: top;\n        white-space: nowrap;\n        width: auto;\n    }\n");var g=function(){function o(e){var i,l=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,o),n(this,"shouldObserveOnScroll",!0),n(this,"navContainerDom",null),n(this,"navWrapperDom",null),n(this,"sectionScrollDom",null),n(this,"itemSectionList",[]),n(this,"curItemData",null),n(this,"events",[]),n(this,"scrollTimer",null),n(this,"cancelAniScroll",(function(){}));var c={horizontalNav:!0,navItemClassName:"js_navItem",getSectionSelector:function(t){return t.getAttribute("href")},currentClass:"current",offset:80,scrollDuration:500,onNavChange:null,onScrollStart:null,onClickNav:null,onScrollEnd:null,scrollToNav:function(t){i&&(cancelAnimationFrame(i),clearTimeout(i),i=null);var e=Date.now(),n=l.navContainerDom.scrollLeft,o=t-n,r=window.requestAnimationFrame||function(t){return setTimeout(t,16)};r((function a(){var s=(Date.now()-e)/300;s<1?(l.navContainerDom.scrollLeft=n+o*s,i=r(a)):l.navContainerDom.scrollLeft=t}))}};this.options=r(r({},c),s),this.navContainerDom=a(e)[0],this.navWrapperDom=this.navContainerDom.firstElementChild,this.init()}var i,s,u;return i=o,(s=[{key:"callHook",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var r=this.options[t];r&&setTimeout((function(){r.apply(void 0,n)}))}},{key:"init",value:function(){this.resolveData(),this.initEvent(),this.scrollEvent()}},{key:"resolveData",value:function(){var t=this;this.navContainerDom.classList.add("lj-nav-container"),this.navWrapperDom.classList.add("lj-nav-wrapper"),this.options.horizontalNav&&this.navContainerDom.classList.add("lj-horizontal-nav");var e=a(".".concat(this.options.navItemClassName));this.itemSectionList=e.map((function(e){return{navItem:e,sectionItem:a(t.options.getSectionSelector(e))[0]}}));try{this.sectionScrollDom=function(t,e){for(var n=t;n;){if([window,document,document.documentElement].includes(n))return window;if(c(n,e))return n;n=n.parentNode}return n}(this.itemSectionList[0].sectionItem)}catch(t){throw new Error("获取不到navItems元素 或者 section 元素")}}},{key:"getCurrentItem",value:function(){for(var t=m(this.sectionScrollDom),e=this.itemSectionList.length-1;e>=0;e-=1)if(v(this.itemSectionList[e].sectionItem,this.sectionScrollDom)<=t+this.options.offset)return this.itemSectionList[e];return this.itemSectionList[0]}},{key:"scrollEvent",value:function(){var t=this.getCurrentItem();t!==this.curItemData&&this.setCurrentNav(t)}},{key:"setCurrentNav",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.curItemData=t,this.itemSectionList.forEach((function(t){return t.navItem.classList.remove(e.options.currentClass)})),this.curItemData.navItem.classList.add(this.options.currentClass);var o=this.navContainerDom.clientWidth,r=this.navWrapperDom.clientWidth;if(r>o){var i=this.curItemData.navItem,a=h(i,this.navContainerDom)+(i.offsetWidth/2-o/2);a=a>0?a>r-o?r-o:a:0,this.options.scrollToNav(a)}n||this.callHook("onNavChange",this.curItemData)}},{key:"navSelect",value:function(t){var e=this;if(t!==(this.curItemData||{}).navItem){this.callHook("onClickNav",t);var n=this.itemSectionList.find((function(e){return e.navItem===t}));this.setCurrentNav(n),this.shouldObserveOnScroll?this.callHook("onScrollStart"):(clearTimeout(this.scrollTimer),this.cancelAniScroll(),this.scrollTimer=null),this.shouldObserveOnScroll=!1;var o=v(n.sectionItem,this.sectionScrollDom)-this.options.offset;this.cancelAniScroll=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500,o=arguments.length>3?arguments[3]:void 0,r=Date.now(),i=m(t),a=e-i,l=window.requestAnimationFrame||function(t){return setTimeout(t,16)},s=null,c=function c(){var u=(Date.now()-r)/n;u<1?(f(t,i+a*p(u)),s=l(c)):(f(t,e),o&&o())};return l(c),function(){return(cancelAnimationFrame||clearTimeout)(s)}}(this.sectionScrollDom,o,this.options.scrollDuration,(function(){e.scrollTimer=setTimeout((function(){e.shouldObserveOnScroll=!0,e.callHook("onScrollEnd")}),60)}))}}},{key:"initEvent",value:function(){var t,e,n,o,r,i,a,s,c,u,h=this,v=(t=this.scrollEvent.bind(this),e=200,a=null,s=0,c=Object.assign({},n),u=function(){s=!1===c.leading?0:Date.now(),a=null,i=t.apply(o,r),a||(o=null,r=null)},function(){var n=Date.now();s||!1!==c.leading||(s=n);var l=e-(n-s);o=this;for(var h=arguments.length,v=new Array(h),m=0;m<h;m++)v[m]=arguments[m];return r=v,l<=0||l>e?(a&&(clearTimeout(a),a=null),s=n,i=t.apply(o,r),a||(o=null,r=null)):a||(a=setTimeout(u,l)),i});this.events.push({target:this.sectionScrollDom,eventName:"scroll",handler:function(){h.shouldObserveOnScroll&&v()}}),this.events.push({target:window,eventName:"resize",handler:function(){h.setCurrentNav(h.curItemData,!0)}}),this.events.push({target:this.navContainerDom,eventName:"click",handler:function(t){t.preventDefault();var e=function(t,e,n){for(;e;){if(n(e))return e;if(e===t||e.parentNode===t)break;e=e.parentNode}return null}(t.currentTarget,t.target,(function(t){return t.className&&~t.className.indexOf(h.options.navItemClassName.replace(".",""))}));e&&h.navSelect(e)}}),l(this.events)}},{key:"destroy",value:function(){l(this.events,"removeEventListener"),this.navContainerDom=null,this.navWrapperDom=null,this.sectionScrollDom=null,this.itemSectionList.length=0,this.curItemData=null,this.events.length=0}}])&&e(i.prototype,s),u&&e(i,u),o}();export default g;
