/** @license @lljj/nav (c) 2020-2021 Liu.Jun License: MIT */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).lljjNav={})}(this,(function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t){return String(t)===t}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;if(t instanceof NodeList)return Array.from(t);if(t instanceof HTMLElement)return[t];if(l(t))return Array.from(e.querySelectorAll(t));throw new Error("请传入一个正确的选择器")}function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"addEventListener";t.forEach((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.target,o=t.eventName,r=t.handler,i=t.useCapture,l=void 0!==i&&i;Array.isArray(o)?o.forEach((function(t){n[e](t,r,l)})):n[e](o,r,l)}))}var c=function(t,e){try{var n=document.defaultView.getComputedStyle(t,"");return t.style[e]||n?n[e]:null}catch(n){return t.style[e]}},u=function(t,e){return c(t,null!==e||void 0!==e?e?"overflow-y":"overflow-x":"overflow").match(/(scroll|auto)/)},h=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.html,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"offsetTop",o=0;null!==t&&t!==e;)o+=t[n],t=t.offsetParent;return o},v=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.html;return h(t,e,"offsetLeft")},f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.html;return h(t,e)};var m=function(t){return t.scrollTop||window.pageYOffset||document.documentElement.scrollTop},d=function(t,e){var n=e>0?e:0;t===window?(document.documentElement.scrollTop=n,document.body.scrollTop=n):t.scrollTop=n},p=function(t){return Math.pow(t,3)},y=function(t){return t<.5?p(2*t)/2:1-p(2*(1-t))/2};!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}(".lj-horizontal-nav {\n    text-align: center;\n    overflow: auto;\n}\n    .lj-horizontal-nav::-webkit-scrollbar {\n        width: 0;\n        height: 0;\n    }\n    .lj-horizontal-nav .lj-nav-wrapper {\n        display: inline-block;\n        vertical-align: top;\n        white-space: nowrap;\n        width: auto;\n    }\n");var g=function(){function t(n){var r,l=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),o(this,"shouldObserveOnScroll",!0),o(this,"navContainerDom",null),o(this,"navWrapperDom",null),o(this,"sectionScrollDom",null),o(this,"itemSectionList",[]),o(this,"curItemData",null),o(this,"events",[]),o(this,"scrollTimer",null),o(this,"cancelAniScroll",(function(){}));var c={horizontalNav:!0,navItemClassName:"js_navItem",getSectionSelector:function(t){return t.getAttribute("href")},currentClass:"current",offset:80,scrollDuration:500,onNavChange:null,onScrollStart:null,onClickNav:null,onScrollEnd:null,scrollToNav:function(t){r&&(cancelAnimationFrame(r),clearTimeout(r),r=null);var e=Date.now(),n=l.navContainerDom.scrollLeft,o=t-n,i=window.requestAnimationFrame||function(t){return setTimeout(t,16)};i((function a(){var s=(Date.now()-e)/300;s<1?(l.navContainerDom.scrollLeft=n+o*s,r=i(a)):l.navContainerDom.scrollLeft=t}))}};this.options=i(i({},c),s),this.navContainerDom=a(n)[0],this.navWrapperDom=this.navContainerDom.firstElementChild,this.init()}var r,l,c;return r=t,(l=[{key:"callHook",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var r=this.options[t];r&&setTimeout((function(){r.apply(void 0,n)}))}},{key:"init",value:function(){this.resolveData(),this.initEvent(),this.scrollEvent()}},{key:"resolveData",value:function(){var t=this;this.navContainerDom.classList.add("lj-nav-container"),this.navWrapperDom.classList.add("lj-nav-wrapper"),this.options.horizontalNav&&this.navContainerDom.classList.add("lj-horizontal-nav");var e=a(".".concat(this.options.navItemClassName));this.itemSectionList=e.map((function(e){return{navItem:e,sectionItem:a(t.options.getSectionSelector(e))[0]}}));try{this.sectionScrollDom=function(t,e){for(var n=t;n;){if([window,document,document.documentElement].includes(n))return window;if(u(n,e))return n;n=n.parentNode}return n}(this.itemSectionList[0].sectionItem)}catch(t){throw new Error("获取不到navItems元素 或者 section 元素")}}},{key:"getCurrentItem",value:function(){for(var t=m(this.sectionScrollDom),e=this.itemSectionList.length-1;e>=0;e-=1)if(f(this.itemSectionList[e].sectionItem,this.sectionScrollDom)<=t+this.options.offset)return this.itemSectionList[e];return this.itemSectionList[0]}},{key:"scrollEvent",value:function(){var t=this.getCurrentItem();t!==this.curItemData&&this.setCurrentNav(t)}},{key:"setCurrentNav",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.curItemData=t,this.itemSectionList.forEach((function(t){return t.navItem.classList.remove(e.options.currentClass)})),this.curItemData.navItem.classList.add(this.options.currentClass);var o=this.navContainerDom.clientWidth,r=this.navWrapperDom.clientWidth;if(r>o){var i=this.curItemData.navItem,l=v(i,this.navContainerDom)+(i.offsetWidth/2-o/2);l=l>0?l>r-o?r-o:l:0,this.options.scrollToNav(l)}n||this.callHook("onNavChange",this.curItemData)}},{key:"navSelect",value:function(t){var e=this;if(t!==(this.curItemData||{}).navItem){this.callHook("onClickNav",t);var n=this.itemSectionList.find((function(e){return e.navItem===t}));this.setCurrentNav(n),this.shouldObserveOnScroll?this.callHook("onScrollStart"):(clearTimeout(this.scrollTimer),this.cancelAniScroll(),this.scrollTimer=null),this.shouldObserveOnScroll=!1;var o=f(n.sectionItem,this.sectionScrollDom)-this.options.offset;this.cancelAniScroll=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500,o=arguments.length>3?arguments[3]:void 0,r=Date.now(),i=m(t),l=e-i,a=window.requestAnimationFrame||function(t){return setTimeout(t,16)},s=null,c=function c(){var u=(Date.now()-r)/n;u<1?(d(t,i+l*y(u)),s=a(c)):(d(t,e),o&&o())};return a(c),function(){return(cancelAnimationFrame||clearTimeout)(s)}}(this.sectionScrollDom,o,this.options.scrollDuration,(function(){e.scrollTimer=setTimeout((function(){e.shouldObserveOnScroll=!0,e.callHook("onScrollEnd")}),60)}))}}},{key:"initEvent",value:function(){var t,e,n,o,r,i,l,a,c,u,h=this,v=(t=this.scrollEvent.bind(this),e=200,l=null,a=0,c=Object.assign({},n),u=function(){a=!1===c.leading?0:Date.now(),l=null,i=t.apply(o,r),l||(o=null,r=null)},function(){var n=Date.now();a||!1!==c.leading||(a=n);var s=e-(n-a);o=this;for(var h=arguments.length,v=new Array(h),f=0;f<h;f++)v[f]=arguments[f];return r=v,s<=0||s>e?(l&&(clearTimeout(l),l=null),a=n,i=t.apply(o,r),l||(o=null,r=null)):l||(l=setTimeout(u,s)),i});this.events.push({target:this.sectionScrollDom,eventName:"scroll",handler:function(){h.shouldObserveOnScroll&&v()}}),this.events.push({target:window,eventName:"resize",handler:function(){h.setCurrentNav(h.curItemData,!0)}}),this.events.push({target:this.navContainerDom,eventName:"click",handler:function(t){t.preventDefault();var e=function(t,e,n){for(;e;){if(n(e))return e;if(e===t||e.parentNode===t)break;e=e.parentNode}return null}(t.currentTarget,t.target,(function(t){return t.className&&~t.className.indexOf(h.options.navItemClassName.replace(".",""))}));e&&h.navSelect(e)}}),s(this.events)}},{key:"destroy",value:function(){s(this.events,"removeEventListener"),this.navContainerDom=null,this.navWrapperDom=null,this.sectionScrollDom=null,this.itemSectionList.length=0,this.curItemData=null,this.events.length=0}}])&&n(r.prototype,l),c&&n(r,c),t}();t.default=g,Object.defineProperty(t,"__esModule",{value:!0})}));
